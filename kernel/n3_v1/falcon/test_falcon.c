#ifndef FALCON
#define FALCON 1024
#endif

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <math.h>

#include "api.h"
#include "inner.h"




static const int8_t ntru_f_16[] = {
	7, -7, 12, 18, 19, 6, 18, -18, 18, -17, -14, 51, 24, -17, 2, 31
};

static const int8_t ntru_g_16[] = {
	-2, -35, 3, 28, -21, 10, 4, 20, 15, -28, 31, -26, 5, 33, 0, 5
};

static const int8_t ntru_F_16[] = {
	16, 65, -6, 15, 26, -10, 14, -9, 22, 48, 26, -14, 15, 21, -23, 4
};

static const int8_t ntru_G_16[] = {
	37, -57, 27, 31, -45, -49, -11, 46, -14, 26, 0, 3, -33, -33, -3, 54
};

static const uint16_t ntru_h_16[] = {
	7768, 1837, 4498, 1226, 9594, 8992, 2227, 6132,
	2850, 7612, 4314, 3834, 2585, 3954, 6198,  589
};

static const int8_t ntru_f_512[] = {
	4, -4, 0, -6, 6, -6, 2, 1, -8, 0, -2, 0, -1, -1, -4, 8, -5, 3,
	-2, 2, 0, -5, -2, -1, 3, -4, -5, -1, 8, 1, 1, 7, 5, 1, 6, 2, -1,
	-13, 1, -4, 9, -4, -2, 4, -4, 0, -1, -1, -3, 2, 1, 1, 1, 3, -3,
	2, -1, -1, -5, 9, 4, -7, -3, -8, -3, -2, -3, -6, -6, -3, -2, -2,
	2, 1, -10, -2, -2, 4, 2, 0, -2, -2, 4, -3, 5, 2, -2, 3, 8, 1, 8,
	-3, -4, 2, 7, -5, -4, -2, -2, -3, 5, -5, 0, -3, -5, 3, -6, -2,
	3, 0, 3, 1, 2, -2, 1, 6, -1, -7, 0, -5, 3, -5, 9, 0, 1, 5, -4,
	0, 5, -1, 4, 3, 5, -6, 2, 0, -7, 1, 0, 0, 2, 4, 1, -7, -3, 4, 4,
	-2, -7, -5, 6, 3, 2, -5, 6, -1, -1, -4, 1, 2, 1, 2, -10, -9, -9,
	-1, 3, -2, -2, -6, 1, -2, -4, -1, 2, 3, 8, 2, 1, -1, 8, 0, 7, 3,
	1, 5, 0, -7, 1, -6, -4, 4, 2, 0, 0, -3, 2, 0, -3, 0, 7, -1, -1,
	-7, 2, 5, 3, 0, 1, 6, -2, -1, 2, 0, -1, -3, -6, -5, -5, -4, 0,
	1, 7, 1, -3, 2, 2, -5, 0, -4, 3, -4, 5, 3, 4, 7, -2, 15, -3, 1,
	1, 4, 5, -9, -3, 4, 2, -4, -4, -3, -1, -4, 3, -1, 1, -8, -4, -1,
	0, -3, 1, -1, 3, 3, 3, -3, -6, -7, 7, 0, -6, 2, -1, 4, 7, 1, 4,
	0, 1, 6, -1, -2, -2, 5, 0, 6, -3, -2, -5, 3, -1, 0, 5, -2, 8,
	-5, -4, 1, -3, 8, 2, -4, 1, 6, 0, 0, -1, 0, -4, -5, -2, 3, -2,
	5, 1, 4, 5, -4, 4, -1, 4, -5, -2, 1, 3, -5, 1, 2, -2, 0, -5, 1,
	8, -3, -4, 3, -2, -3, -4, 4, 3, -2, 6, -3, -2, 4, 0, -2, 0, -5,
	1, -9, 5, 6, -2, -6, 1, 5, -1, -7, 1, 2, 5, 2, 0, -1, 0, -2, -4,
	-1, -8, 5, -5, 9, -4, -4, 2, -5, -1, 0, 1, 4, 3, 1, -2, -7, -8,
	-4, -4, 4, 3, -1, 4, -1, -1, 1, 0, 6, 1, 0, -6, -2, 0, -3, 0,
	-1, -1, 0, 3, -5, -2, -5, 6, 2, -4, -3, 4, -8, 1, -1, 4, -3, 5,
	-2, 8, 7, -1, -3, -3, -2, 0, -4, 4, 0, -6, -4, -2, 5, 8, -3, 3,
	-1, 0, -5, -5, 0, 2, -5, -2, -3, 1, 6, 3, 1, -3, 4, -3, 0, -7,
	-1, -3, 1, -5, 1, -4, -2, 2, 4, 0, 1, 5, 2, 2, -3, -5, -8, 4,
	-2, -3, 2, 2, 0, 8, -5, 2, -7, 0, 3, -1, 0, 4, -3, 1, -2, -4,
	-6, -5, 0, -4, 1, -3, 9, 1, -3, -2, -3, 5, -1, -4, -7, 1, 1
};

static const int8_t ntru_g_512[] = {
	-6, -2, 4, -8, -4, 2, 3, 4, 1, -1, 3, 0, 2, 3, -3, 1, -7, -5, 3,
	-3, -1, 3, -3, 8, -6, -6, 0, 6, 4, 7, 3, 5, 0, -5, -3, -5, 7, 3,
	-1, -4, 3, 4, -1, 1, 3, -3, -4, -4, 4, -5, -1, 3, 7, -2, -4, -2,
	-3, -1, -2, -1, -2, -6, -7, -3, -6, -3, -6, 4, -1, -5, 1, 4, -4,
	3, -1, -6, 6, -2, 2, -6, 5, -7, 8, -3, 0, -2, 0, 7, 1, 3, 6, 4,
	-5, 2, 2, 2, 4, -4, -5, -4, -3, 4, -7, 7, -6, -2, -7, 1, -2, -2,
	-3, 1, 3, 7, 0, -1, -5, 4, -8, -8, 0, 3, 6, -3, 2, 6, -1, 1, -5,
	-4, 2, -3, 8, -2, 2, 3, 0, 1, 6, 4, 4, -4, -1, -3, -2, -5, 3, 9,
	0, 4, -1, 1, -4, 0, 3, 0, -2, 8, 0, 1, 0, -1, 1, 9, -1, -4, -1,
	3, 5, -2, -2, 1, -1, 1, -1, 0, 1, 0, -6, -2, 0, 7, -3, -4, -1,
	-6, -2, 5, -2, 0, 4, -3, -5, 0, 1, -1, -3, 5, 5, -4, -4, -5, -1,
	9, -1, -5, -7, -1, -2, 4, 2, 5, -4, -1, -5, 8, -3, -6, -2, 1,
	-2, 1, 1, 4, -4, -1, 4, 1, 1, 0, -5, 1, 7, 2, -3, 3, -2, -4, 1,
	-6, -1, -3, 7, 6, 0, -2, 2, -6, -4, -3, 2, -7, 7, 0, -11, -1, 3,
	4, 0, 6, -8, -4, -1, 1, 0, -3, 7, 0, 0, -2, -1, -4, 0, -1, -3,
	7, -6, -2, -2, -1, 0, -2, 8, -6, 4, 4, 6, -2, -1, 0, -13, 1, 2,
	0, 5, -7, 3, -2, -6, -3, -4, 4, -1, 1, 3, -6, 1, -5, -8, 2, -11,
	-1, 2, -2, 0, 0, 1, 1, -4, -5, 0, 1, 0, 1, -6, -2, 2, 0, 7, 1,
	-1, 1, -2, 1, -3, 1, 2, 1, -7, -2, 2, -1, 4, 1, -2, -2, 0, 4,
	-3, -6, 2, 3, 1, 1, -4, 6, -2, -4, -3, 0, 4, -5, 0, 1, 8, 2, 2,
	-1, 1, -2, -4, -1, 4, 4, -1, 7, 2, -1, -3, -8, 3, 1, 1, 0, -1,
	1, -7, -8, 2, 1, -2, 1, 0, 4, 1, 1, -2, -1, -5, 3, -4, -1, -1,
	-8, 2, -4, 3, 2, -5, 0, 1, 5, 2, -5, -2, 3, 7, 5, 6, 5, -2, 1,
	3, -7, 7, -3, -8, -2, 2, 3, 3, 5, -2, -4, -1, 7, -2, 7, -3, -2,
	0, 3, 5, 0, 0, 4, 8, -1, -5, 3, -2, -2, -5, -5, -2, 2, 5, -8,
	-1, -2, -4, 6, 0, 6, -5, -1, -5, -6, 9, 5, -2, 4, -1, -8, -2,
	-2, 1, -8, -5, 6, -1, 0, 5, -6, -3, -3, -2, -6, -2, 0, -1, -3,
	7, -3, -1, 3, 6, 3, -2, -4, 2, 1, -1, 11, 3, 4, -1, -6, 1, 2, 3,
	3
};

static const int8_t ntru_F_512[] = {
	-3, -27, 4, 18, 39, 7, 20, -13, 33, -29, 3, 38, 30, 26, -6, 24,
	-26, 16, 24, -48, -18, -21, 3, -14, -2, 6, -9, 42, 22, 21, 33,
	-27, -14, -14, -56, -68, -2, -33, 6, -38, -43, 21, 13, 6, 2,
	-69, -10, -30, -27, 23, -1, 41, -21, 11, -20, 15, 39, 5, 41, 15,
	-28, -34, 9, -11, 9, -1, -8, 61, 8, 13, -23, 2, 7, -23, -21,
	-54, -11, -9, -19, 40, 37, -2, -16, 19, -16, 2, -78, -35, -19,
	11, 17, -46, -16, 25, 0, 22, 13, -15, -33, 13, -15, -34, 33,
	-13, 38, 39, 37, -29, 40, 7, 63, 35, 15, 21, -24, 16, -6, 30,
	12, 18, 61, 17, -11, -15, 11, 0, -15, -2, -14, -26, -1, -42,
	-10, -52, 64, 45, 22, 6, -22, 32, -50, -16, -12, -16, -8, 34,
	-17, -18, 7, 19, 37, 41, -5, -22, -12, -7, -17, -27, -17, 4, 36,
	0, 22, -4, -50, 24, 30, 5, 1, -50, 43, 0, 0, -6, -9, 34, 0, 14,
	-27, 17, 35, -30, -13, 3, -23, -46, 17, -34, 30, 24, 47, 31, -7,
	11, 10, 16, 30, 27, -4, 11, -4, -14, -28, 49, 0, 27, -5, -10,
	53, -50, -13, -15, 13, -10, -26, 2, -3, 88, 22, -27, 40, -23, 3,
	-42, 2, -27, -12, 35, 26, -33, 38, -42, -5, 17, -24, 6, -10, 13,
	-10, -30, -35, -17, 25, 49, -29, 48, 19, 37, 48, -25, -31, -41,
	-15, -1, 19, -17, -7, -16, 2, 5, 12, 0, -15, -19, -6, -32, -4,
	-56, 14, -6, -7, 17, 24, -1, 17, -35, 5, 3, -64, -15, 4, 0, -31,
	4, -10, -18, 55, 13, -13, 23, -30, -11, -29, -21, 15, -18, 30,
	39, 16, -27, 31, 4, 31, 39, -49, 11, -25, 37, -42, -72, 28, -57,
	13, 34, 6, 10, -17, -3, -19, -43, -1, -32, 9, -11, 9, 11, -23,
	6, 28, -34, -12, -42, -7, 42, -18, -2, 22, -30, -4, -42, 10, 54,
	-16, 19, -23, -4, 18, -58, 26, -3, -38, 20, 38, 23, 20, 0, 10,
	49, 47, 18, 27, -11, -10, -14, 0, 6, 6, -18, -6, 14, -38, -16,
	12, -17, 17, -21, -52, -3, -53, 9, 9, -4, 44, 9, -4, 17, 2, 10,
	-28, -13, 28, -12, 11, -33, -2, 33, 0, -51, 2, -33, 20, -47, 23,
	42, 2, 52, -18, -17, 35, 6, 27, 3, 11, 24, -8, 0, -35, -44, -22,
	-49, 61, 3, -15, -2, -14, 46, -24, -10, -24, -24, -21, -10, -51,
	-3, 31, 20, 1, -44, 18, 9, 38, 26, -17, -8, 2, 33, 24, -8, -9,
	-20, 32, 54, 47, -11, 40, 3, -58, 13, 17, 29, -21, 27, 4, -31,
	14, 14, 17, 19, -29, 19, -86, -29, -15, -35, 18, 53, -10, 9, 13,
	-38, 9, -4, 80, 0, 6, 1, 15, -14, 0, -5, 45, 26, 50, 28, 21, 1,
	-8, -6, 12, 32, 5, -21, -1, 54, 14, 22, 27, 6, 8, -18, 33, -5
};

static const int8_t ntru_G_512[] = {
	-58, -47, 36, 14, 2, -20, 24, 35, 38, -31, 20, -1, -17, -29, -6,
	25, 16, 4, -75, 32, 20, 17, -8, 24, 13, 7, -11, -2, 3, -2, 6,
	16, 22, 37, -25, -4, -32, -21, 57, 0, 20, 73, 20, -9, 6, -49,
	12, 14, 60, 15, 50, 15, 9, -2, 13, -8, 38, 12, -5, 9, -7, -1,
	-30, -2, -28, -6, 6, -18, 5, 1, -15, -15, -1, 15, -4, -12, -1,
	-37, -12, 33, -2, -17, -8, -57, -64, -7, 3, 3, -15, 1, 3, 15,
	-21, 67, -29, -4, 7, -21, -7, -8, 12, 38, 3, 45, -26, -37, 10,
	24, -15, -24, 23, -13, -27, 12, 14, -16, 22, -19, 15, 1, -7, 0,
	-6, 28, 2, -7, 0, -10, -19, 14, -13, -16, 22, 14, -7, -1, -17,
	31, -7, 12, 4, -8, -13, 18, -8, -38, 6, 49, 40, 1, -5, 1, 17,
	-21, -3, -9, 15, 27, 43, 60, 29, -1, -3, 2, -41, 18, -18, -26,
	29, 13, 12, 15, 38, -24, -25, 8, 17, 10, -32, -3, -39, -29, 23,
	30, 6, 3, 23, -15, -26, 34, -59, 3, -54, 37, 27, -26, 23, -40,
	-10, -15, 7, 9, -1, 24, -33, -36, 29, -7, 13, 29, 56, -13, 36,
	-37, -45, 13, -11, 43, -9, 24, 16, -13, 13, 13, 10, -18, 16, 3,
	-14, -27, -16, -5, -35, -25, -42, 51, -5, -41, 20, -27, 47, 14,
	75, 14, -74, 26, -18, 18, -12, -13, 8, -44, 6, 0, -16, 36, 32,
	-33, 6, 5, -23, -14, -32, 15, 27, 56, 10, -43, 8, 16, -63, 8,
	34, -24, -3, 15, 13, -3, -31, -14, -24, 28, 11, -41, -4, 14, 1,
	-11, 40, 32, -22, 19, -16, 27, -2, 36, 40, -11, -2, 2, -11, -2,
	35, -44, 6, 6, -40, 3, -8, -27, -28, 5, -6, -12, -2, -4, -19,
	-64, 36, -33, -16, -5, 20, -9, 10, 59, 16, -8, 27, 28, -6, 10,
	-8, 11, -35, 23, 35, 34, 47, 13, 2, 44, 8, 38, 4, 34, 41, 15,
	20, 28, 29, 35, 4, 23, 7, 8, -19, -17, 8, 5, 10, -21, -9, 15,
	-28, -4, -23, -17, 18, -15, -2, 9, -24, -7, 7, 51, -31, 40, -57,
	30, 23, -12, -18, -9, 37, -29, -4, 18, -10, 20, -54, -21, 23,
	56, 28, 30, -3, 15, -31, -41, 14, 66, 41, 15, 39, 34, -9, 4, 33,
	18, 25, 6, 38, -27, 63, -21, -24, 43, 11, -37, 16, 26, -31, -30,
	16, -20, -3, 10, 11, -58, 18, 13, 0, 22, -25, 13, -32, -14, 5,
	52, 31, 30, -3, 9, 18, -7, 4, -2, 1, 11, -8, 8, -9, -29, 28,
	-25, 51, 47, 24, -72, -4, 41, -15, 17, 50, 2, -1, 2, -41, -33,
	-20, 6, -19, -33, 23, 8, -19, 12, -19, -2, -61, -7, -19, 6, 8,
	-23, 27, 38, 12, -17, 39, 8, 23, -41, 14, 25, 16, -44, -46, 11,
	31, -6, 9, 24, 23, 37, -57, 22, 21, -22, 21, 44
};

static const uint16_t ntru_h_512[] = {
	3605, 11394, 3623, 9500, 11987, 4336, 3361, 1348, 6563, 8102,
	758, 8455, 5789, 7614, 797, 11215, 7518, 3116, 4556, 1762,
	11267, 9507, 4586, 5420, 4091, 6788, 1729, 6433, 4730, 1830,
	4200, 1416, 3705, 5380, 5767, 9261, 924, 6822, 8978, 2536, 8232,
	10530, 10137, 11653, 11704, 1887, 11653, 10218, 9207, 10699,
	3288, 1478, 7261, 10152, 3871, 10134, 7359, 9993, 9510, 8661,
	419, 1826, 978, 11037, 10899, 3311, 2064, 5939, 11072, 1748,
	9516, 5458, 7665, 4459, 5937, 5615, 7288, 3438, 6009, 3217, 264,
	3696, 608, 11576, 2774, 10976, 11146, 11188, 3237, 10913, 3541,
	11755, 9412, 5720, 4226, 1154, 9010, 9922, 3994, 11252, 11575,
	11077, 9308, 7784, 11086, 12047, 5310, 8524, 4117, 504, 3145,
	12216, 2718, 1181, 5446, 1818, 6156, 1945, 11240, 7398, 8307,
	8259, 10113, 11431, 10691, 2147, 2742, 8242, 12031, 8808, 7609,
	3657, 3567, 2485, 7669, 4388, 3255, 1395, 596, 9635, 6739,
	10284, 4910, 9410, 11788, 10978, 3877, 4006, 1860, 6225, 8834,
	11969, 11742, 9733, 8790, 7871, 10347, 2658, 4468, 947, 3384,
	9733, 6496, 382, 81, 7977, 7138, 8962, 10195, 2830, 10227, 5302,
	9974, 9157, 7442, 4931, 9761, 5759, 2115, 431, 12242, 2353,
	7529, 7822, 6343, 3370, 9369, 8491, 6742, 5681, 10973, 412,
	12105, 6913, 5565, 3760, 4378, 4454, 9070, 1289, 2596, 5355,
	12117, 2787, 3798, 4954, 9708, 2191, 2935, 4073, 7455, 11661,
	4170, 8782, 9611, 8647, 2318, 4779, 11339, 3962, 361, 9358,
	7727, 11723, 9018, 10552, 3025, 6852, 6028, 10603, 7147, 8434,
	5604, 4483, 5954, 426, 11403, 2643, 8294, 9504, 7268, 8958,
	2773, 7764, 5926, 8213, 2100, 8814, 7540, 4212, 7012, 353, 7166,
	5717, 9799, 10379, 7768, 9515, 2534, 4504, 5410, 5358, 1879,
	11581, 10692, 2614, 11002, 11667, 7333, 6932, 4254, 9503, 7386,
	2581, 4153, 6079, 6149, 5496, 2397, 11735, 6496, 9250, 11872,
	10842, 2934, 4022, 10681, 914, 4397, 7287, 9673, 4709, 4895,
	3770, 3146, 7254, 4953, 11018, 9062, 3817, 11979, 8723, 3091,
	2675, 8946, 7376, 3652, 6861, 8298, 5547, 11, 4758, 10734, 7434,
	11702, 6466, 9135, 11199, 10059, 503, 2510, 1730, 6101, 11965,
	10264, 6045, 11690, 11530, 761, 9270, 4531, 5482, 6951, 5776,
	10348, 2668, 5246, 8046, 7106, 11302, 3276, 6632, 12008, 6564,
	8465, 1953, 5904, 1036, 3109, 5020, 11945, 458, 11742, 5271,
	4474, 9918, 7963, 11786, 8318, 756, 560, 11377, 1084, 9634,
	9203, 1062, 8461, 1845, 3719, 6672, 6660, 4711, 11337, 10460,
	5367, 4072, 7043, 5567, 6356, 657, 8877, 3633, 11487, 10421,
	10877, 5052, 2174, 4711, 11853, 4461, 10942, 11619, 7591, 3424,
	3372, 4493, 11393, 7115, 9057, 7145, 2060, 9137, 707, 1968,
	7853, 645, 253, 2697, 9294, 8357, 7503, 6187, 7505, 8302, 4635,
	8899, 9258, 8559, 7988, 9571, 243, 6979, 8233, 11555, 5257,
	8361, 1836, 11185, 3771, 3517, 10585, 4756, 10212, 2035, 2778,
	6798, 11229, 11768, 8707, 7931, 3744, 10939, 5317, 6104, 11137,
	3936, 5418, 4368, 201, 3094, 8211, 6803, 2559, 3164, 6846, 8515,
	8894, 8556, 2219, 9593, 6391, 3374, 4868, 192, 2791, 4309, 62,
	20, 9968, 8831, 11185, 1365, 9722, 5623, 2398, 5049, 2241, 6060,
	998, 4233, 1455, 5324, 1053, 5626, 1726, 11569, 12033, 4897,
	859, 1676, 2097, 11147, 5155, 5187, 2026, 12050, 5615, 5450,
	260, 7526, 11923, 6346, 7221, 405, 882, 842, 4621, 4130, 3513,
	114, 3673, 4914
};

static const int8_t ntru_f_1024[] = {
	3, 2, -4, -3, 0, -5, 4, -3, -1, 1, -2, 2, 3, 0, -1, 0, 0, 0, 0,
	0, -2, -2, -3, 3, -4, -1, -1, 0, 2, -4, 0, -9, -3, 5, 3, -1, 1,
	-5, 1, -1, -6, 0, -1, -1, 5, -1, 4, -1, -2, 2, -3, -1, 1, -3, 1,
	1, -5, -2, -2, 0, 0, 5, -8, -1, -1, 0, 0, 2, 0, 4, -3, 4, 3, -3,
	-2, 6, -2, -2, 0, 3, 0, 0, -1, -2, 0, 1, -2, -1, 7, 0, -4, 1,
	-1, -2, 2, -1, -5, 5, -1, -4, -2, -1, 2, -1, 2, -1, -3, 3, 1, 2,
	1, -2, 3, 3, 1, 4, 2, 0, 3, 0, -3, 0, 7, -5, 4, -3, -1, 1, -6,
	0, -1, 0, -5, 1, -2, 2, -1, -1, -2, 3, 4, -1, 0, -1, 0, 1, 3,
	-2, 6, 4, 1, 1, 1, -1, 3, 1, -3, 0, 0, -1, 2, -3, 2, -4, 1, -1,
	-1, 1, -2, -1, -2, -6, -8, -3, 3, -2, 0, 3, -1, 1, 0, 5, -2, 0,
	-2, 1, 2, 1, -2, -5, -3, -2, 2, -1, 1, 1, 0, 1, 1, -9, 0, 1, -2,
	2, 5, 0, 3, 4, -1, -5, -2, -2, 0, 2, 0, -2, 3, 0, -1, -2, -3,
	-6, -2, 1, -7, -4, -2, 1, -1, -1, -3, -3, 2, -3, 2, 1, 2, -4,
	-2, 5, -1, 1, -2, 3, -5, 5, 1, 1, 1, 2, -4, 1, 2, -3, -5, -4, 2,
	-3, 3, -4, -4, 5, 2, 0, -4, 3, -3, -3, 3, 0, -2, -3, -2, 0, -3,
	5, 8, -2, 2, 2, -1, 10, -1, -1, 1, -4, 3, -1, 3, 1, -1, 3, -3,
	5, 0, 4, -3, 4, -5, 3, -3, -1, -4, 3, 1, 0, 2, -1, -4, -1, 4,
	-5, -6, 3, 5, 4, -2, 0, 5, 1, 1, -1, 1, -3, 6, -3, -3, 1, -6, 3,
	-3, 3, 1, 0, 0, -2, -4, -1, 1, 0, -1, -1, 4, -3, 2, 2, -5, 4, 3,
	-3, -2, -1, 1, 1, -3, 4, 6, 0, 4, -3, -1, 1, 6, 2, 3, -2, -3,
	-2, 3, -5, 3, 0, 0, -2, -1, -3, 2, 5, 0, 4, 2, 3, -2, -4, 3, 1,
	-5, -2, 2, -1, -1, -4, 5, 0, 0, 2, -2, -4, 3, 4, 1, 5, 0, 0, 1,
	0, 5, -2, -1, 1, -3, -1, -1, -1, 2, 2, -3, 0, 1, -3, 2, 0, -2,
	3, 2, 0, 3, -1, 0, 2, -4, 0, -3, 3, 3, -1, -1, -2, 3, 2, -1, -5,
	1, 2, 3, 3, 3, -2, 8, 6, -2, 1, 4, -3, 0, 4, 1, 1, 0, 0, 1, 0,
	-1, 5, 0, -5, 4, 3, 5, 2, 0, 0, 3, -2, 3, -4, 2, -3, -1, 3, -2,
	1, -1, 5, 1, 0, 5, -1, 0, -1, -2, -1, -4, -1, -2, 2, -6, -2, 5,
	0, -5, -2, 4, -1, -3, -3, -2, 2, -1, -2, 0, 0, -4, 2, -5, 1, -4,
	-1, 0, -1, -2, 5, -4, 4, -1, -2, 6, 3, 6, 3, -3, 1, 0, 1, 6, 3,
	1, -3, -1, -2, -1, 0, 0, -1, -1, -1, -2, -2, -1, -1, 2, 1, -4,
	-4, -5, -4, 3, 1, 1, 1, 4, -2, 0, 1, 2, 3, 0, 5, -5, 3, -1, 3,
	4, -3, -3, -4, -10, -1, -2, 2, -2, -3, 1, 2, 0, 1, 0, 2, -3, 2,
	1, 1, 0, -2, 1, 0, -3, -1, 0, -3, -1, -4, -5, 3, 3, -1, -5, -1,
	0, -1, 2, -3, 3, 1, 0, 0, -1, 2, 0, 6, -4, 5, -1, 1, 3, -2, -1,
	1, 0, 1, 2, -7, 2, 4, 2, 1, -3, -6, 2, -2, 0, 0, -2, 2, 2, 0,
	-2, 1, 0, 1, 0, 1, 2, -3, 2, 3, 1, 1, 2, 7, 0, 1, 0, 0, -1, 2,
	1, -1, -1, 0, 0, 3, 2, 1, 1, 0, -5, 5, 0, 3, 3, 5, 3, -3, 0, 3,
	1, 4, 0, 6, -1, 3, 4, -1, 5, 5, 4, -4, -2, 2, 3, -10, -3, 1, 1,
	4, 2, -3, 4, 2, -2, -4, -2, -4, 1, 0, 0, 2, -3, 1, -1, -4, 0,
	-1, 4, 1, -3, 0, -1, 1, 3, 2, 3, 1, 2, -3, -3, 0, 2, 4, 0, 0, 6,
	-2, -1, -2, -2, 4, -1, -1, -1, -2, -4, -6, 2, 1, 1, -6, -2, -2,
	1, 0, -3, -3, -3, 3, 3, -1, 1, -3, -1, -1, 1, -6, -1, 2, -1, -4,
	0, 0, -4, 2, 3, 0, -4, -1, 0, 2, 0, -1, 1, 3, 3, -1, -2, 5, 0,
	-1, 1, 0, 2, -5, -1, 0, 1, -5, -4, -4, 0, 1, 4, -6, -3, 1, 0, 2,
	-5, -1, 0, 1, -5, 1, 1, 0, 1, -1, 3, 4, 3, -1, -1, 1, 1, 0, -2,
	0, -1, -4, 0, 2, 1, 2, 4, 2, -1, -4, 2, 2, -1, 0, -1, 0, 0, -2,
	3, 0, -1, -4, 0, -2, -2, -2, 4, 3, 5, 4, 1, 4, -2, 3, 0, -4, -2,
	-3, 2, 2, 0, -6, 2, -7, -1, 3, 1, -2, 4, -2, 0, 1, 2, 4, 0, 1,
	1, 0, 0, 0, 1, 4, -10, -2, -3, -4, 7, -6, -2, -3, 4, 4, -4, -2,
	6, 2, -4, -1, 1, 1, 3, 0, 1, 0, -2, -4, 1, 4, 1, -5, 1, 1, 6,
	-3, 0, 1, -2, -4, 0, -1, -3, 2, 6, 5, 1, -1, 3, 1, 1, 1, -1, 4,
	-5, -3, -1, -2, -3, 0, 2, 2, 2, 2, -6, 7, 7, -1, 3, -1, -2, -2,
	5, 0, 1, 1, -3, 3, -6, 2, 1, 3, 3, 1, -1, 0, 2, 1, -5, -1, -4,
	1, -2, 5, -3, -2, 0, 3, 0, 1, -1, -1, 1, 0, 3, -1, 3, -1, 1, 2,
	0, -4, 2, -1, -3, -2, 0, -3, -2, 0, 1, 0, -5, -2, 4, 1, 7, -5,
	1, 1
};

static const int8_t ntru_g_1024[] = {
	3, -1, -7, -1, 4, -2, 3, -1, -3, -3, -5, 3, -1, -1, 2, -3, -5,
	0, 0, 1, -3, 3, 3, -2, -2, 0, -4, 2, 1, -1, 3, -5, 5, 0, -1, -3,
	-1, -2, 5, 3, 4, -2, -2, 0, -4, 0, 3, 3, 0, 1, 3, -1, -2, -3,
	-1, -2, 3, 1, 0, -2, 0, -2, 0, 0, 1, 3, -2, -3, 3, -3, -1, -2,
	-1, -3, -3, 1, 1, 8, 1, 4, -2, -1, -5, -4, 3, 5, 0, 0, 7, 4, 1,
	1, -4, -2, 4, 4, -3, -4, 5, 3, 2, 0, 1, -6, 2, -1, -3, -1, -1,
	1, 2, 5, 0, 3, 1, 3, 0, -4, -3, -3, -1, -1, 1, 1, 2, 0, -2, 0,
	3, 3, 3, -4, 1, -2, -4, 3, 3, 5, -4, -5, -1, -1, 3, -2, -4, -1,
	-5, 1, -1, 0, 2, -1, 1, 1, -3, -2, -1, -4, -4, -1, -1, 0, -1,
	-1, 3, -2, -2, 3, -6, 2, 2, 0, 2, -3, 0, 3, -2, -2, 2, -1, 1, 4,
	-2, 0, 0, 0, 0, 4, 0, 2, -4, -1, 5, -2, -6, 2, 1, 3, 1, 3, 0, 3,
	1, 2, 0, -4, -2, -3, 4, 2, 0, -8, -2, 2, 5, 2, 0, 1, -2, 0, -1,
	0, 3, 3, 1, 0, 0, 2, 2, -1, -3, 3, -2, 3, 1, -2, 5, 1, 4, -2, 3,
	-2, -3, -2, -1, 2, -5, -4, -2, -3, -6, -3, -2, -3, -3, -3, -1,
	1, -1, 4, -1, -5, -3, 0, 3, 6, 0, 2, -1, 5, -1, 0, 2, 7, 6, -1,
	2, -2, 4, 6, 0, 1, 4, 4, 0, 5, 1, -3, 4, 1, 3, 1, -1, -2, -4,
	-1, 0, 0, 3, -6, -1, 2, 4, -3, -1, 0, -3, 2, 1, 2, 4, 1, -1, -2,
	-1, -3, -2, -6, -1, 1, 2, -2, 0, 0, 0, -3, 1, -2, 5, 1, 1, -5,
	-4, 0, 0, -2, 0, 3, 4, 5, 2, -4, 0, -4, 3, -2, 0, -3, -4, -1, 4,
	0, -3, -2, 1, -1, 2, -3, 1, 0, 0, -3, 0, 5, 2, -2, -4, 2, 0, 0,
	-3, 0, -1, -1, -1, -1, 3, 7, -1, -2, -5, 2, 5, 1, 4, 2, -3, 0,
	-5, -4, 1, 0, 1, -3, 4, 2, -5, -1, 2, -4, 0, 1, 0, 1, 0, -1, 0,
	-2, -4, 4, -2, 0, 1, 1, 0, 2, 0, 0, -4, -5, -3, 0, -4, -5, 2, 1,
	0, -3, 4, -1, 3, -4, -5, -1, 4, -1, 0, 1, -4, 5, -1, 5, 1, -1,
	0, -3, -3, 3, -5, -3, 1, -1, 0, 4, -2, 2, 1, -2, -3, -1, -2, -3,
	-3, 1, -2, 8, -2, 0, 3, -2, 3, 3, 3, -2, 4, 0, 2, 3, 1, 3, 0,
	-1, -1, 3, 1, 1, -1, 5, 1, -1, 0, -3, 1, -4, 1, -1, -4, -1, 6,
	-4, 6, -2, 0, -2, 0, 4, -1, 1, 6, 7, 5, -1, 3, 3, 0, -1, 1, -6,
	-1, -4, 4, -1, 3, 4, 3, -3, -1, 2, 0, -3, 2, -1, -2, 1, -3, 0,
	-1, -5, -1, 4, -2, -6, 1, 0, 6, 2, 1, -3, 2, 1, -1, -1, 4, -4,
	-2, -2, 5, 1, 5, -2, -6, 1, 0, 1, 4, 4, -3, -1, -4, 1, 0, -1, 0,
	-3, 4, -2, 4, 3, 1, 4, 6, 2, 1, -1, 1, -5, -2, -3, 2, 0, -1, -1,
	-5, 3, -3, 2, 0, 1, -4, -1, 7, -1, 2, -2, 3, 0, 0, -4, 4, 2, 4,
	1, 1, 2, 3, -2, 3, 1, 0, 0, -4, 0, 2, 1, 1, -1, 4, 4, -4, -3, 5,
	-1, -1, 1, 3, 3, 1, -9, 0, -6, 5, 0, 0, -2, 3, 0, 2, -2, 3, -6,
	1, 1, -1, 3, 1, 2, 0, 3, -1, 0, -2, -3, 7, 1, -3, -1, -2, 3, -3,
	1, 4, 3, -3, -3, -4, -6, -5, -1, 6, -5, 3, 0, -1, 0, 4, -5, -2,
	1, -2, 3, 6, 2, -4, -5, -6, -3, 2, -3, -4, -2, 1, 1, 0, 1, -2,
	2, -2, -1, 1, 2, 2, -4, -3, -1, 0, -1, 2, -4, 1, -1, 0, -3, 1,
	2, -5, 4, 0, -3, 3, 5, 3, -4, -2, 2, 1, 1, -4, -2, 1, -1, 0, 0,
	3, 0, 1, 0, 1, 1, -1, -4, 3, 3, 1, 0, 1, -1, 1, -2, 3, 3, 5, -1,
	3, -3, -1, 1, -2, -1, 0, 1, 1, -2, 0, 3, -1, -3, -2, 1, 1, 2,
	-7, -2, 1, 5, 0, 0, 0, -4, -4, 0, 1, -1, 4, 0, 0, 3, 1, 3, -4,
	7, 4, -4, 0, 5, 4, -3, -1, 0, 0, -3, -4, 3, 0, -1, 2, -2, 0, 6,
	0, -2, 3, 1, 6, 3, -2, 2, 1, -1, -2, -4, -3, -2, -2, 0, 2, 0,
	-4, -3, -1, -3, 1, 0, -6, 2, 0, 4, 4, 1, -2, -1, -3, 3, -4, -4,
	-2, 1, -5, -1, 2, 1, -2, 0, -2, 2, -1, 0, 3, -2, 1, -6, -2, -1,
	0, -2, -2, 1, 0, 4, -1, 8, 3, 0, 1, 5, 1, -3, 0, 2, 1, 1, -1, 4,
	0, 4, 6, -2, 0, 0, -3, 5, -6, -3, 5, 2, -2, 1, -1, 6, 5, -3, -4,
	-3, 2, 3, -5, 2, 2, -2, -4, 6, -4, 2, 0, -4, 5, 2, -1, 1, 0, -2,
	2, 2, 0, -3, 0, -7, 0, -1, 1, 3, 3, 2, -5, -2, 0, 5, -4, 1, 2,
	2, -1, 4, 5, 2, 2, 2, 0, 0, 2, 1, 3, 2, -4, 4, -2, -1, 2, -2, 0,
	3, -2, -1, 6, 1, 3, 0, 4, 0, -2, -1, 1, 0, -3, 3, 2, 3, -1, -3,
	-3, 3, -2, 3, -2, 0, -1, 3, -3, -2, 1, 4, -4, 2, 5, -7, 1, 0,
	-5, 1, 2, -1, 3, -2, 3, -1, -2, 2, 0, 0, 0, -3, -2, 4, 7, 1
};

static const int8_t ntru_F_1024[] = {
	36, -13, 88, 1, 13, -66, 9, -2, -12, 30, 23, -18, -15, 8, -2, 5,
	19, 13, 14, -22, -22, 29, -18, 8, -45, 28, -4, -46, 30, 40, -26,
	-3, -1, -2, -54, 4, 34, -38, -32, 55, -25, -24, 4, -35, -9, 8,
	23, 24, 35, 17, 29, 7, 41, -3, -13, 39, 25, 24, -34, 18, -55,
	22, -61, -23, 18, 3, 1, -3, 32, -20, -2, -63, 19, 21, -13, 3,
	-7, -17, 5, -40, -29, 8, 6, -43, 27, 31, 3, -28, -46, 76, 31,
	-16, -4, 59, 38, -6, -6, -3, 34, -19, -10, -39, -20, -15, -3,
	-11, -41, 9, -90, 21, -26, 24, -2, -18, -36, 18, -2, -4, -18,
	-67, 14, 7, -22, -22, -28, 42, -57, 32, 7, 25, 7, 30, -45, -9,
	-2, 8, 28, -14, 19, -19, -47, 37, -34, 45, -32, -8, -35, 52,
	-31, 35, -14, -10, 36, -65, -16, -21, -5, 4, 21, -61, 22, 13,
	-55, -5, -22, 14, -10, -35, 8, -5, 27, -31, -32, 3, 0, -12, -25,
	27, -5, -22, 3, -6, 0, 21, -5, 45, 36, -42, 16, -2, -9, -16,
	-44, 0, 44, 3, -9, -51, -32, 11, -4, -7, 33, 15, -9, 13, -6, 15,
	15, -30, 10, 14, -8, 27, 20, -3, -10, 22, 14, 7, -15, 31, -17,
	-20, -14, 4, -2, 26, 27, -7, 32, 49, 27, -40, -4, -35, 11, 3,
	17, 35, 11, -14, 35, -6, 7, 10, -38, 12, 43, -42, 44, -20, -3,
	33, 35, 14, 1, 10, -9, -11, -20, 31, 30, -2, -2, -6, 17, -10,
	-10, -10, 49, -23, -18, -3, -1, 12, 19, -44, -21, -13, -19, 25,
	4, -23, -20, 6, -15, -2, 21, 19, -6, -4, 43, -24, 31, 22, -15,
	55, -5, -3, -8, -6, -14, 23, 0, 32, -28, 48, 55, 43, 2, 17, -4,
	56, 58, 32, 3, -6, 43, 11, -3, -9, -26, -17, -6, 23, 29, 30,
	-31, 5, 27, 11, 9, 30, 32, 66, 10, 33, -40, -26, 19, 38, -11, 4,
	12, -57, 30, -14, 29, -5, 12, -9, -17, 20, 40, -1, -19, -5, -16,
	-38, -25, -24, -1, 21, -21, -47, -1, -8, -53, 39, 7, -36, -19,
	4, 0, 2, 16, 6, 20, 8, 8, -7, -42, -1, 4, -17, -7, -10, -24, 0,
	-29, -1, -15, -2, 3, 9, -21, -2, -20, -15, -68, -42, 21, -40,
	-23, -3, -5, -18, -2, -17, -20, 17, 10, 16, -54, 27, 5, -21, 21,
	4, -54, -25, 2, 61, 39, -25, 47, -5, 20, 12, 8, -21, -12, 16,
	-13, 23, -4, -47, -12, -15, 5, 20, -4, -22, 37, -43, -14, -30,
	-21, 15, -24, 1, -13, 25, -3, -8, -4, 9, -13, -1, -14, 39, 19,
	-8, -11, 45, 32, -25, 18, 77, 13, 14, 21, 38, -42, 15, 28, -17,
	6, -2, 17, -36, 21, -33, 13, 12, -6, 36, -5, 9, 7, 1, -17, 30,
	-16, -3, -39, -12, -6, -21, -28, 3, -13, -17, 29, 23, -12, 17,
	35, -18, -10, 1, 26, -33, 69, 57, -12, -15, 43, 18, 27, -31,
	-29, 37, -5, 50, -56, -22, -57, -1, 21, -15, -27, -48, -20, -28,
	-4, -31, -20, 9, 10, 15, 12, -7, -38, 23, 0, 9, 3, 15, 28, 31,
	-8, 4, 19, 3, -7, 30, -14, 27, -7, -25, -20, -10, -20, 27, -6,
	-30, -8, 27, -5, -23, 52, -44, -33, 48, -20, 10, -21, 7, -34,
	-1, 26, 40, -11, 4, 46, -30, -13, -9, 27, 13, -13, 13, -4, 11,
	34, -32, -3, 51, 24, -45, 39, 14, 15, -55, 12, -28, -21, -14, 3,
	-16, -25, -13, 35, 18, -7, -27, 51, -16, 29, -28, 5, 1, -32, 3,
	-25, -7, -15, 33, 8, 37, -20, 26, 25, 12, 13, 15, 8, 4, 11, 8,
	-31, -1, 8, 13, -31, 22, -7, -3, 7, 12, 10, -12, -62, -49, -12,
	-5, -3, -53, -30, -7, -56, 20, 45, 6, -46, -32, -15, -13, 9,
	-18, 11, -5, 12, -6, 10, -62, 8, 11, -18, 27, 16, -5, -6, 4,
	-28, -6, -30, -58, 11, -8, -40, -51, 20, 27, 17, 12, -9, -28,
	-11, -8, -22, -18, -16, -36, 14, 17, -44, 2, 42, 16, -9, -31,
	-16, -3, -14, 41, -22, 16, -1, 32, 12, 4, -36, 18, -41, 13, 31,
	-35, 14, 8, -10, 19, -9, -4, -36, -15, -62, 0, 16, -28, -54, 4,
	20, -9, 14, 18, -26, -30, 19, 10, 10, -5, -10, 7, 23, -7, -31,
	-2, 19, -63, -14, 0, -18, -3, -21, -33, 11, -52, -21, -4, -48,
	-35, -6, -4, -14, -13, -1, 14, -16, -21, 9, -37, -31, -16, 4,
	-17, 2, -4, -17, 2, -51, -16, -16, 3, 59, 13, -16, -30, 17, 9,
	35, -11, -31, 32, -7, -26, 28, 7, 19, 28, -17, -49, -30, -9, 23,
	19, -2, 1, -3, 9, 48, 11, -54, 9, -22, 25, 8, 22, -52, 37, -14,
	-10, -30, 20, 52, 3, 10, 17, 56, 33, -3, 41, 53, 41, 4, -7, -25,
	8, -45, 29, -11, 5, 29, 60, -15, -8, 14, -7, -33, -14, 6, -12,
	-2, -2, -10, -12, -16, -21, 2, 5, -14, 53, 41, 61, 12, 31, 4,
	22, -16, 36, -4, -42, 38, -29, -10, 20, 20, 35, 66, 16, 12, -50,
	-5, 1, -16, 32, 33, 46, -3, 11, 11, -19, 28, 5, 38, 15, -35, -6,
	1, -6, -17, 2, -28, 25, 42, 8, -2, -11, 14, -33, -42, 23, 21,
	-31, 63, -8, 15, 26, -16, 13, -3, 39, -16, 58, -14, -14, -22,
	-30, -26, -51, 4, -9, -18, -5, -56, -48, -60, 10, -52, -28, -6,
	-12, -35, 31, -22, -31, -13, 8, -14, -8, 23, -20, -45, -12, 30,
	8, 7, 9, -12, -13, -2, -29, 18, -1, 30, -17, -26, -41, 58, -66,
	-6, 8, -78, 25, 29, 0, -40, -27, 16, 40, -15, -28, 18, -54, 16,
	-12, 1, -4, 17, -21, 12, 30, -7, 45, -8, -28, 8, -41, -1, 42, 3,
	-6, -47, 22, 44, -78, -45, 41, 12, -30, -23, 13
};

static const int8_t ntru_G_1024[] = {
	56, -4, -28, 13, 4, 26, -14, -10, -21, -32, 21, -21, 0, 59, 26,
	-6, -81, -7, -42, -1, 8, 20, 37, -33, 36, 1, -6, 14, -1, -73,
	15, 18, 7, 34, -45, 7, 19, -30, 8, 8, -56, -13, 7, 20, -20, 14,
	4, 11, -36, 21, 19, -16, -17, 10, -45, -4, -12, 18, -9, 23, 20,
	1, -27, -7, 1, 1, 33, -27, -23, 56, 35, -5, 16, 43, -1, 11, -18,
	5, 59, 14, -39, 11, -34, -59, 6, -18, 43, -25, 22, -7, 9, -28,
	-9, -40, 47, 0, -12, -22, -12, -44, -17, -12, -10, -5, 4, -20,
	-10, 25, 38, 2, 0, -17, 14, -16, 6, 9, 7, -29, 11, 48, 14, 10,
	0, 24, 4, -5, 56, 20, 1, 35, 62, 7, -31, 36, 36, 24, -19, -33,
	19, 9, -13, -16, 2, 1, -29, 3, -3, 42, 8, 27, -19, 51, 16, 14,
	28, -1, 24, 3, 1, 47, -13, -43, 9, 17, 3, 21, 26, -19, -6, 4,
	-36, 7, 26, 19, 40, -44, 27, -20, 9, -1, 19, -1, 0, -51, 5, -5,
	-45, 11, 26, -1, 1, 39, -6, 14, -14, -34, -29, -6, -15, -23, 24,
	-7, 16, -51, 55, -30, 2, 13, 1, -37, 33, -29, 11, 14, -44, 46,
	40, -45, 59, -6, 3, 18, -46, 20, 17, -2, 0, 27, -20, 1, -7, -16,
	-29, 0, -2, -19, 19, -10, 16, -15, -2, 2, -10, 4, 27, -4, 2, 0,
	15, 35, 19, 25, 21, 32, -9, 26, -28, -23, -2, 7, -24, 75, -3, 6,
	21, 45, -8, -12, 21, -12, -29, -7, 34, -13, -22, 28, 32, 20, 18,
	-22, 2, 17, -12, 37, 37, -33, 5, 28, 27, 55, -30, -9, 10, 23,
	12, -9, -26, 30, 5, 2, 24, -37, 9, -25, -50, 33, 3, -21, -38,
	-19, 44, 41, 9, 1, 34, 6, -26, -44, -26, 15, -3, -21, -24, 40,
	-43, 28, 2, -30, -13, -8, -40, 1, 31, -2, -16, -16, -25, 33, 1,
	-23, -51, -40, -37, -12, -38, 78, 15, -31, 32, 41, 26, 26, -25,
	-60, 15, -43, 27, -54, 0, 25, -7, -27, 15, -18, 20, 20, -76, -3,
	35, -39, 20, 28, 21, 10, 6, -41, -29, -31, -55, -41, 0, -8, 4,
	-17, 21, -21, -12, 11, 4, -17, 6, 26, 11, 9, -13, -41, 29, -7,
	-4, 21, 12, 2, -1, -23, 3, -5, 1, 30, -10, 9, 40, -63, -27, 51,
	-29, 4, -1, -7, 30, 30, -21, 32, -17, -51, 28, 34, 22, -5, -5,
	42, 7, -1, -16, -15, -23, 10, -9, -3, 1, 26, -12, 16, 5, 18, 13,
	-1, 28, 8, -52, -42, 12, -3, -28, 30, -3, 11, -14, -3, 34, -75,
	-13, 6, -39, 14, 72, -16, 18, -17, -36, -3, 5, -9, -38, -42, 4,
	7, 3, 74, 2, 9, -23, -32, -43, -59, -15, -4, 31, 12, -16, -24,
	35, -7, 0, -8, -3, -8, 6, 1, -57, 13, -8, 22, 31, 40, -16, 35,
	34, -32, -60, -21, 8, -1, -13, -39, 14, 17, -7, 33, -35, -6,
	-18, 0, 29, -5, -9, 40, -19, -45, 24, -41, -7, 32, 19, 28, 28,
	-17, 10, 18, 6, 29, 1, -1, 17, 28, 18, -22, -16, 20, 51, 8, 2,
	18, 16, -9, 40, -8, -20, -31, 11, -5, 34, -25, -40, -48, -9,
	-36, 4, 17, 15, 8, -18, 27, -24, -25, -13, 22, 21, -21, -25, -2,
	-32, 7, 20, -8, -26, -23, 21, -3, 34, -15, 0, -17, -21, 56, -38,
	-2, 18, -44, -14, 31, -2, -24, 3, -18, 18, 16, -24, -35, -48, 5,
	-36, 28, 15, 13, 32, -14, 14, -38, -9, -62, -11, 6, 6, -26, -46,
	72, -63, -35, 16, -4, -19, 45, -20, -28, 1, 26, 36, -35, 30,
	-13, 39, -29, 16, -30, 14, 5, 4, -11, -6, 22, -9, 5, -9, 14,
	-27, -30, 23, 23, -2, -7, 30, 0, 6, 32, -43, -17, 11, 10, -29,
	-15, 111, 15, 10, 13, 7, 16, -2, 3, -3, -6, 38, -10, -11, 5,
	-34, -2, 14, -32, -21, 4, -5, 0, -8, 27, -50, -7, 23, 8, -17,
	-63, -87, -1, 34, 5, -1, -11, 3, -6, 33, -9, -45, -34, 2, -23,
	46, 43, -11, 12, -21, -7, 17, -48, -42, -3, 7, 2, 24, 8, 71, 6,
	0, 9, -16, 6, 17, 20, -2, 6, -44, -13, 44, 23, 27, 13, 37, -10,
	58, 8, -12, -4, -15, 14, 27, -47, 18, -68, -6, -9, -16, 2, 7,
	-15, -47, 34, 1, -38, -25, -19, 1, -10, 14, 7, 9, -20, -1, -21,
	4, -13, 18, -26, -10, 31, 51, -59, 15, -3, -19, -70, -17, 46,
	-14, 24, 32, 15, 34, -23, -36, -16, -7, -10, 2, 36, 7, -12, -51,
	-25, -8, 23, -18, -17, 7, -48, 9, -26, 44, -25, 44, 32, 28, -10,
	11, 12, -17, 4, 16, 6, -19, 32, 22, -31, 16, 8, 31, -4, 17, -21,
	1, 56, 36, 21, -31, -4, 0, -46, -26, -44, 61, -61, 2, -21, 45,
	15, -14, -35, -13, 5, -38, -10, -19, -7, -7, -33, 33, -11, -12,
	29, 17, -27, -46, -48, -25, -13, 6, 25, -12, -12, -29, -58, -2,
	-29, 5, -11, -15, -19, 32, -58, 14, -35, -3, -20, -16, -32, -24,
	-45, -18, -3, 0, -1, -43, -9, 12, -29, -2, 1, -9, -26, 5, -2, 9,
	-17, 32, 27, -3, -27, 2, -7, -13, 4, 6, 46, 38, 28, -27, -3,
	-19, -38, 64, 13, 9, -16, 35, 46, 8, -80, 15, -16, -19, -26,
	-10, 48, 8, -11, -8, -2, -16, -22, 50, 9, -14, -52, 39, 11, 49,
	2, 5, -11, 13, -4, 10, 11, -23, -23, -10, 14, 31, 42, 18, 0, 49,
	34, 19, -25, 15, -41, 30, 8, 18, 29, -6, 15, -17, 5, 30, 2, -19,
	12, 43, -32, 31, -39, 8, 21, 16, -12, -8, 24, 37, 8, -13, -54,
	0, -44, -12, -26, 31, 5, -22, 51, 11, -7, -22, 27, 17, 12, 20,
	-8, 9, -11, 48, -21, 9, 24, 2, -4
};

static const uint16_t ntru_h_1024[] = {
	6857, 4524, 6980, 4278, 8521, 9214, 399, 11461, 10346, 9318,
	2768, 1272, 396, 5635, 2424, 3623, 2071, 9145, 8766, 3391, 4900,
	10525, 6985, 3336, 5084, 11240, 5203, 4517, 7825, 974, 6450,
	11728, 3727, 1190, 1946, 2049, 10661, 1728, 1985, 8185, 9223,
	9410, 912, 7934, 2032, 377, 5915, 4515, 2076, 4073, 2109, 6749,
	7387, 4215, 11826, 2227, 4483, 10801, 6125, 5658, 4570, 11193,
	3749, 10418, 5800, 7159, 310, 2683, 453, 5616, 5109, 11698,
	1957, 11587, 11845, 11324, 3939, 3660, 6103, 1382, 6149, 6923,
	1333, 7200, 9403, 5990, 10319, 3473, 4771, 3113, 1322, 6743,
	7880, 11899, 3652, 1437, 6650, 8034, 11683, 11315, 2877, 8676,
	9741, 10509, 10783, 10635, 11008, 213, 3492, 8626, 9271, 4771,
	5099, 10209, 6359, 7738, 10860, 5853, 4632, 9862, 5942, 252,
	10959, 11867, 1685, 4189, 5995, 11443, 5328, 10337, 2968, 5209,
	8779, 4330, 7128, 11161, 9016, 12220, 4751, 4429, 7602, 5861,
	7151, 7129, 772, 4128, 8860, 4537, 4010, 1037, 1692, 11048,
	6880, 3575, 11950, 2203, 2670, 3213, 3925, 9414, 6968, 11107,
	11333, 11878, 11390, 3409, 1632, 5743, 11214, 4130, 5383, 10064,
	8173, 11054, 5112, 7029, 2850, 1905, 7673, 3131, 3383, 10728,
	8997, 4775, 6026, 206, 1602, 6698, 84, 8650, 4051, 2857, 1654,
	10234, 3560, 2220, 10072, 4755, 711, 3377, 3830, 1588, 6249,
	9108, 6301, 718, 4896, 4000, 5810, 14, 7962, 11835, 1619, 10486,
	3549, 3698, 4990, 2693, 2161, 7265, 7865, 10853, 5758, 532,
	9771, 9170, 9181, 10730, 943, 12226, 10180, 12238, 7892, 740,
	1961, 2829, 676, 5308, 8939, 9874, 11816, 8850, 2977, 2717, 535,
	11753, 2410, 4915, 8862, 3229, 87, 8181, 6423, 2900, 7322, 2728,
	11030, 9252, 660, 8255, 5084, 9638, 9905, 300, 10871, 8115,
	3921, 10583, 8542, 11888, 8610, 12287, 8303, 4353, 1249, 8437,
	4800, 11879, 11321, 226, 394, 3180, 8426, 8815, 11081, 10343,
	5780, 3187, 8139, 8663, 3271, 8829, 3961, 8000, 10424, 8944,
	8953, 8797, 11506, 9527, 5086, 3654, 2990, 2609, 9285, 10676,
	2126, 8322, 8388, 2907, 1729, 8000, 11960, 10595, 12191, 6735,
	9877, 2994, 5468, 8463, 9718, 2, 1224, 9842, 2220, 7347, 10016,
	5484, 11643, 3603, 4027, 8718, 1504, 5330, 6070, 6726, 10243,
	5581, 11371, 2288, 998, 11901, 9880, 8241, 3448, 10681, 12014,
	564, 4560, 6851, 9235, 5722, 10116, 12008, 702, 9412, 1818,
	2166, 2521, 3449, 9976, 1317, 8202, 2198, 2879, 9909, 8232,
	4358, 9168, 2723, 6954, 7861, 1599, 21, 768, 2337, 8793, 3970,
	3427, 6800, 3319, 10882, 3474, 11336, 6751, 2944, 2916, 2479,
	6692, 10943, 1129, 10958, 9778, 4105, 1160, 1789, 4091, 11799,
	9847, 4003, 7156, 6, 7913, 5539, 930, 5480, 4256, 4410, 11099,
	7276, 858, 2462, 7336, 7936, 10066, 9162, 1859, 4488, 7896,
	9090, 433, 11723, 12017, 2998, 2568, 7557, 3811, 5754, 6153,
	2684, 6011, 745, 3994, 10864, 26, 6792, 4045, 12039, 8465, 9526,
	3324, 4640, 2950, 11189, 11560, 10968, 3467, 9643, 3390, 3105,
	11058, 10171, 7104, 2221, 2882, 10809, 7349, 5094, 2277, 11876,
	5610, 9833, 11556, 9212, 1093, 4875, 1258, 6525, 1379, 6528,
	8903, 6134, 6783, 3749, 7107, 7032, 6685, 5443, 5050, 10430,
	12242, 11782, 9733, 1619, 3481, 11713, 8961, 1719, 6641, 2111,
	578, 6688, 317, 11397, 6930, 6025, 12121, 9635, 11230, 6031,
	4549, 10556, 5810, 915, 9655, 9997, 9300, 11651, 3638, 6822,
	2744, 6442, 11872, 4596, 9029, 6843, 7691, 146, 8712, 5846,
	9537, 2265, 8123, 10530, 3748, 10109, 4081, 8648, 6032, 243,
	5257, 7387, 3266, 11825, 9483, 5681, 8116, 6123, 5512, 1832,
	12174, 6471, 5779, 9994, 5717, 3438, 10887, 7041, 5482, 5776,
	5052, 1277, 113, 1592, 397, 11378, 8540, 5539, 2871, 4794, 3498,
	6522, 9072, 11037, 7679, 7192, 3190, 4453, 10689, 7319, 4307,
	9129, 611, 8733, 7051, 2177, 4032, 400, 8267, 10724, 6343,
	11699, 2709, 2348, 9276, 199, 8140, 1116, 4362, 10542, 7509,
	4463, 3631, 8311, 10476, 4188, 5615, 541, 11358, 10783, 2653,
	5769, 7483, 233, 7151, 7427, 6954, 8993, 8388, 2634, 2867, 8188,
	10115, 9728, 10919, 2716, 2602, 10405, 8148, 7446, 4372, 4018,
	7482, 9473, 6256, 743, 11460, 2574, 10848, 7890, 6186, 277,
	8438, 6377, 9923, 1538, 8021, 1912, 2915, 8575, 7640, 1224,
	6644, 7740, 8476, 7237, 8105, 8741, 8510, 2956, 7727, 5456,
	4878, 6062, 5590, 4643, 2031, 12027, 7298, 11101, 423, 11766,
	6001, 8391, 11344, 7039, 925, 12087, 4715, 7775, 2577, 12100,
	10177, 7515, 8393, 7854, 7358, 2549, 8037, 7490, 9570, 11450,
	7333, 9792, 6517, 6246, 6324, 5652, 4287, 2916, 10244, 6843,
	1032, 10596, 10106, 412, 1649, 796, 787, 9141, 8210, 11119,
	8722, 5557, 8075, 10581, 5333, 646, 11955, 8382, 10460, 249,
	10396, 1425, 10106, 9653, 2083, 9412, 9482, 10358, 5238, 4889,
	10735, 5696, 10184, 10472, 8912, 4715, 4135, 1850, 6734, 788,
	7911, 12091, 5068, 2196, 8528, 1228, 7261, 6719, 5451, 22, 7250,
	5546, 3002, 1364, 3609, 815, 9625, 6174, 11030, 1121, 5227,
	11682, 127, 9743, 2882, 2013, 6410, 3887, 5624, 6044, 6535,
	10445, 11640, 754, 806, 1728, 10444, 3467, 10796, 1342, 560,
	6412, 9877, 4231, 1004, 7563, 6241, 6650, 7678, 9513, 9268,
	5824, 756, 6364, 382, 6099, 11818, 3452, 10664, 9035, 1892,
	3627, 7790, 2766, 4747, 10766, 2582, 8247, 1343, 5404, 8999,
	1306, 2323, 1697, 3027, 3992, 10237, 12264, 2504, 12196, 285,
	3341, 1023, 11597, 65, 3054, 7012, 3354, 3802, 6381, 11090,
	7956, 8016, 5817, 3082, 7822, 10676, 10795, 9182, 3766, 1386,
	7018, 9919, 4122, 4277, 994, 957, 10047, 4963, 6036, 1829, 3699,
	5927, 2986, 11757, 1091, 8586, 4136, 5998, 8614, 738, 7930,
	9614, 1038, 3465, 9461, 8800, 448, 4790, 6902, 557, 2952, 10752,
	10914, 3678, 10642, 6378, 4775, 8587, 424, 160, 4814, 2921,
	4061, 1553, 10018, 3960, 5267, 1357, 11229, 9706, 5480, 3599,
	695, 9316, 12014, 8205, 274, 3219, 7113, 2914, 4379, 2025, 3948,
	10733, 2075, 9903, 6767, 7202, 5303, 10864, 11908, 2946, 1579,
	5946, 11135, 3629, 12006, 1620, 6884, 6120, 9640, 3085, 8987,
	6885, 126, 8477, 119, 7775, 10599, 11996, 1533, 6606, 9624,
	7770, 3292, 11468, 11115, 9034, 44, 1631, 3867, 10484, 8799,
	6863, 10298, 6792, 10913, 1051, 3927, 3297, 5283, 7269, 10315,
	8364, 7328, 2905, 9803, 8593, 1567, 7314, 934, 10166, 7739,
	2512, 8874, 11011, 10479, 7844, 3646, 6388, 7202, 9880, 4708,
	1057, 9014, 11431, 6222, 4398, 2374, 6684, 4743, 7242, 8114,
	8995, 1222, 2096, 5121, 10994, 8697, 10848, 10235, 2380, 8095,
	7857, 6687, 8380, 7399, 3751, 5398, 98, 7175, 3353, 3777, 8408,
	10568, 12088, 5008, 10713, 10027, 3345, 11243, 2602, 2825, 9460,
	2218, 5381, 9106, 12214, 844, 7720, 8328, 3552, 7008, 11397,
	6321, 1422, 2261, 251, 11402, 176, 10570
};


void *xmalloc(size_t size) {
    void *ptr = malloc(size);
    if (!ptr && size != 0) {
        // Handle allocation failure
        exit(1);
    }
    return ptr;
}

void xfree(void *ptr) {
    free(ptr);
}


static void
check_eq(const void *a, const void *b, size_t len, const char *banner)
{
	size_t u;

	if (memcmp(a, b, len) == 0) {
		return;
	}
	fprintf(stderr, "%s: wrong value:\n", banner);
	fprintf(stderr, "a: ");
	for (u = 0; u < len; u ++) {
		fprintf(stderr, "%02x", ((const unsigned char *)a)[u]);
	}
	fprintf(stderr, "\n");
	fprintf(stderr, "b: ");
	for (u = 0; u < len; u ++) {
		fprintf(stderr, "%02x", ((const unsigned char *)b)[u]);
	}
	fprintf(stderr, "\n");
	exit(EXIT_FAILURE);
}



static void
test_sign_self(const int8_t *f, const int8_t *g,
	const int8_t *F, const int8_t *G, const uint16_t *h_src,
	unsigned logn, uint8_t *tmp)
{
	int i;
	size_t n;
	inner_prng_context rng;
	char buf[20];
	uint16_t *h, *hm, *hm2;
	int16_t *sig;
	uint8_t *tt;
	fpr *expanded_key;

	n = (size_t)1 << logn;
	h = (uint16_t *)tmp;
	hm = h + n;
	sig = (int16_t *)(hm + n);
	hm2 = (uint16_t *)sig;
	tt = (uint8_t *)(sig + n);
	if (logn == 1) {
		tt += 4;
	}

	memcpy(h, h_src, n * sizeof *h);
	Zf(to_ntt_monty)(h, logn);

	/* sprintf(buf, "sign %u", logn); */
	memcpy(buf, "sign 0", 7);
	buf[5] = '0' + logn;

	inner_prng_init(&rng);
	inner_prng_inject(&rng, (uint8_t *)buf, strlen(buf));
	inner_prng_flip(&rng);
	for (i = 0; i < 100; i ++) {
		uint8_t msg[50];  /* nonce + plain */
		inner_prng_context sc, sc2;
		size_t u;

		inner_prng_extract(&rng, msg, sizeof msg);

		inner_prng_init(&sc);
		inner_prng_inject(&sc, msg, sizeof msg);
		inner_prng_flip(&sc);
		sc2 = sc;
		Zf(hash_to_point_vartime)(&sc, hm, logn);
		Zf(hash_to_point_ct)(&sc2, hm2, logn, tt);
		for (u = 0; u < n; u ++) {
			if (hm2[u] != hm[u]) {
				fprintf(stderr, "hash_to_point() mismatch\n");
				exit(EXIT_FAILURE);
			}
		}
		Zf(sign_dyn)(sig, &rng, f, g, F, G, hm, logn, tt);
		if (!Zf(verify_raw)(hm, sig, h, logn, tt)) {
			fprintf(stderr, "self signature (dyn) not verified\n");
			exit(EXIT_FAILURE);
		}

		if (i % 10 == 0) {
			printf(".");
			fflush(stdout);
		}
	}

	expanded_key = (fpr *)tt;
	tt = (uint8_t *)expanded_key + (8 * logn + 40) * n;
	Zf(expand_privkey)(expanded_key, f, g, F, G, logn, tt);

	for (i = 0; i < 100; i ++) {
		uint8_t msg[50];  /* nonce + plain */
		inner_prng_context sc;

		inner_prng_extract(&rng, msg, sizeof msg);

		inner_prng_init(&sc);
		inner_prng_inject(&sc, msg, sizeof msg);
		inner_prng_flip(&sc);
		Zf(hash_to_point_vartime)(&sc, hm, logn);
		Zf(sign_tree)(sig, &rng, expanded_key, hm, logn, tt);

		if (!Zf(verify_raw)(hm, sig, h, logn, tt)) {
			fprintf(stderr, "self signature (dyn) not verified\n");
			exit(EXIT_FAILURE);
		}

		if (i % 10 == 0) {
			printf(".");
			fflush(stdout);
		}
	}

	printf(" ");
	fflush(stdout);
}


static void
test_sign(void)
{
	uint8_t *tmp;
	size_t tlen;

	printf("Test sign: ");
	fflush(stdout);

	tlen = 178176;
	tmp = xmalloc(tlen);

	test_sign_self(ntru_f_16, ntru_g_16, ntru_F_16, ntru_G_16,
		ntru_h_16, 4, tmp);
	test_sign_self(ntru_f_512, ntru_g_512, ntru_F_512, ntru_G_512,
		ntru_h_512, 9, tmp);
	test_sign_self(ntru_f_1024, ntru_g_1024, ntru_F_1024, ntru_G_1024,
		ntru_h_1024, 10, tmp);

	xfree(tmp);

	printf("done.\n");
	fflush(stdout);
}


static void
test_keygen_inner(unsigned logn, uint8_t *tmp)
{
	size_t n;
	int8_t *f, *g, *F, *G;
	uint16_t *h, *hm, *h2;
	int16_t *sig, *s1;
	uint8_t *tt;
	int i;
	inner_prng_context rng;
	char buf[20];

	printf("[%u]", logn);
	fflush(stdout);

	/* sprintf(buf, "keygen %u", logn); */
	memcpy(buf, "keygen 0", 9);
	buf[7] = '0' + logn;

	inner_prng_init(&rng);
	inner_prng_inject(&rng, (uint8_t *)buf, strlen(buf));
	inner_prng_flip(&rng);
	n = (size_t)1 << logn;
	f = (int8_t *)tmp;
	g = f + n;
	F = g + n;
	G = F + n;
	h = (uint16_t *)(G + n);
	h2 = h + n;
	hm = h2 + n;
	sig = (int16_t *)(hm + n);
	s1 = sig + n;
	tt = (uint8_t *)(s1 + n);
	if (logn == 1) {
		tt += 4;
	}
	for (i = 0; i < 12; i ++) {
		uint8_t msg[50];  /* nonce + message */
		inner_prng_context sc;

		Zf(keygen)(&rng, f, g, F, G, h, logn, tt);

		inner_prng_extract(&rng, msg, sizeof msg);

		inner_prng_init(&sc);
		inner_prng_inject(&sc, msg, sizeof msg);
		inner_prng_flip(&sc);
		Zf(hash_to_point_vartime)(&sc, hm, logn);
		do {
			Zf(sign_dyn)(sig, &rng, f, g, F, G, hm, logn, tt);
			memcpy(s1, tt, n * sizeof *s1);
		} while (!Zf(is_invertible)(sig, logn, tt));
		Zf(to_ntt_monty)(h, logn);
		if (!Zf(verify_raw)(hm, sig, h, logn, tt)) {
			fprintf(stderr, "self signature not verified\n");
			exit(EXIT_FAILURE);
		}
		if (!Zf(verify_recover)(h2, hm, s1, sig, logn, tt)) {
			fprintf(stderr, "self signature recovery failed\n");
			exit(EXIT_FAILURE);
		}
		Zf(to_ntt_monty)(h2, logn);
		check_eq(h, h2, n * sizeof *h, "recovered public key");

		printf(".");
		fflush(stdout);
	}
}

static void
test_keygen(void)
{
	uint8_t *tmp;
	size_t tlen;
	unsigned logn;

	printf("Test keygen: ");
	fflush(stdout);
	tlen = 90112;
	tmp = xmalloc(tlen);
	for (logn = 1; logn <= 10; logn ++) {
		test_keygen_inner(logn, tmp);
	}
	xfree(tmp);
	printf("done.\n");
	fflush(stdout);
}

int
main(void)
{
	unsigned old;

	old = set_fpu_cw(2);

	test_sign();
	test_keygen();

	set_fpu_cw(old);
	return 0;
}

